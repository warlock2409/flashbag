<div class="overlay" *ngIf="!shopCode">
  <h1 class="text-white!">
    “Every great business starts with a single idea.”
  </h1>
  <h3 class="text-white!">
    Create your shop to unlock your workspace and access your invoices.
  </h3>
</div>

<!-- Loading spinner -->
<div class="loading-overlay" *ngIf="loading">
  <img src="../../../assets/png/logo.png" alt="Loading..." class="animate-spin" />
</div>
<div class="min-h-screen antialiased text-neutral-900 bg-white">
  <!-- Added proper top padding for navbar spacing -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 responsive-padding-top">
    <!-- Top Bar -->
    <header class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 responsive-header">
      <div class="flex items-start gap-3">
        <div class="h-9 w-9 rounded-md bg-violet-200 ring-1 ring-inset ring-neutral-200 grid place-items-center mt-1">
          <span class="text-sm font-semibold tracking-tight"
            style="font-family: 'Inter', ui-sans-serif, system-ui; letter-spacing: -0.02em;">IN</span>
        </div>
        <div>
          <h1 class="text-xl sm:text-2xl font-semibold tracking-tight text-neutral-900 responsive-title"
            style="font-family: 'Inter', ui-sans-serif, system-ui; letter-spacing: -0.02em;margin: 0;">
            Invoices
          </h1>
          <p class="text-xs text-neutral-600 responsive-subtitle">
            Track, search, and manage your billing
          </p>
        </div>
      </div>

      <div class="flex items-center gap-2 sm:gap-3 responsive-actions">
        <button mat-stroked-button (click)="openNewInvoice()" class="responsive-button">
          <i class="fa-solid fa-plus mr-2"></i>
          <span class="responsive-button-text">New Invoice</span>
        </button>
      </div>
    </header>

    <!-- Controls - Modified for tablet view -->
    <section class="mt-6 flex flex-col lg:flex-row lg:items-center gap-3 lg:gap-4 responsive-controls">
      <!-- Search - Moved to same row as export/new invoice on tablet -->
      <div class="relative flex-1 lg:order-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="search"
          class="lucide lucide-search pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-500">
          <path d="m21 21-4.34-4.34"></path>
          <circle cx="11" cy="11" r="8"></circle>
        </svg>
        <input id="search" type="text" placeholder="Search by invoice or client…" [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
          class="w-full rounded-md bg-white pl-9 pr-3 py-2 text-sm text-neutral-900 placeholder-neutral-500 ring-1 ring-inset ring-neutral-200 focus:outline-none focus:ring-neutral-300 responsive-search"
          style="font-family: 'Inter', ui-sans-serif, system-ui;">
      </div>
      <!-- Segmented Filter - Takes more space on tablet -->
      <div class="filters-container w-full lg:w-auto lg:order-1 scroll-fade">
        <div class="inline-flex w-full items-center rounded-lg bg-white ring-1 ring-inset ring-neutral-200 p-1 responsive-filters horizontal-scroll"
          role="tablist">
          <button *ngFor="let tab of tabs" (click)="selectTab(tab.value)"
            class="filter-btn flex-1 lg:flex-none inline-flex items-center cursor-pointer gap-2 rounded-md px-3 py-1.5 text-sm font-medium transition-colors responsive-filter-btn whitespace-nowrap"
            [ngClass]="{
            'text-neutral-900 bg-neutral-100': selectedTab === tab.value,
            'text-neutral-600 hover:text-neutral-900': selectedTab !== tab.value
            }" [attr.aria-selected]="selectedTab === tab.value">
            <span class="inline-flex h-5 min-w-[28px] items-center justify-center rounded-full text-xs ring-1 ring-inset"
              [ngClass]="tab.badgeClass">•</span>
            <span class="responsive-filter-text">{{ tab.label }}</span>
            <span class="ml-1 text-neutral-500 text-xs tabular-nums" *ngIf="tab.count !== null">
              ({{ tab.count }})
            </span>
          </button>
        </div>
      </div>
    </section>
    
    <!-- Pagination -->
    <mat-paginator [length]="totalElements" [pageSize]="pageSize" aria-label="Select page" class="mt-4"
      (page)="onPageChange($event)">
    </mat-paginator>
    <!-- Table (Desktop) -->
    <section class="mt-6 hidden lg:block rounded-xl bg-white ring-1 ring-inset ring-neutral-200 overflow-hidden responsive-table">
      <div
        class="grid grid-cols-12 px-4 sm:px-6 py-3 text-xs uppercase tracking-wide text-neutral-500 border-b border-neutral-200 responsive-table-header">
        <div class="col-span-3">Invoice</div>
        <div class="col-span-3">Client</div>
        <div class="col-span-2">Issued</div>
        <!-- <div class="col-span-2">Due</div> -->
        <div class="col-span-3 text-right">Amount</div>
        <div class="col-span-1 text-right">Status</div>
      </div>

      <div id="table-body" class="divide-y divide-neutral-100">
        <!-- Rows -->
        @for (invoice of invoiceList; track $index; let rowIndex = $index) {
        <div data-role="row" (click)="openExisitingInvoice(invoice)"
          class="grid grid-cols-12 px-4 sm:px-6 py-4 hover:bg-neutral-50 transition-colors hover:border-neutral-200 cursor-pointer responsive-table-row fade-in"
          [style.animation-delay]="rowIndex * 0.05 + 's'">
          <div class="col-span-3 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
              data-lucide="file-text" class="lucide lucide-file-text w-4 h-4 text-neutral-500">
              <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
              <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
              <path d="M10 9H8"></path>
              <path d="M16 13H8"></path>
              <path d="M16 17H8"></path>
            </svg>
            <span class="font-medium text-neutral-900">{{invoice?.invoiceNumber?.split('-')?.slice(-3)?.join('-')}}</span>
          </div>
          <div class="col-span-3">
            <div class="font-medium text-neutral-800">
              {{ invoice.customer?.firstName }}
            </div>
            <div class="text-sm text-gray-400">
              {{ invoice.customer?.email }}
            </div>
            <div class="text-sm text-gray-400">
              {{ invoice.customer?.contactNumber }}
            </div>
          </div>
          <div class="col-span-2 text-neutral-500">{{ invoice.invoiceDate | date:'MMM d, y, h:mm a'}}</div>
          <!-- <div class="col-span-2 text-neutral-500">Sep 11, 2025</div> -->
          <div class="col-span-3 text-right text-neutral-900">{{invoice.grandTotal | currency:'INR':'symbol':'1.2-2'}}
          </div>
          <div class="col-span-1 flex items-start justify-end">
            <span class="inline-flex items-start rounded-full px-2 py-0.5 text-xs ring-1 ring-inset"
              [ngClass]="statusClasses[invoice.status!]">
              {{ invoice.status }}
            </span>
          </div>
        </div>
        }
      </div>
    </section>

    <!-- Cards (Tablet/Mobile) -->
    <section id="cards" class="mt-6 space-y-4 lg:hidden responsive-cards">
      <!-- Card -->
      @for (invoice of invoiceList; track $index; let rowIndex = $index) {
      <article data-role="card" 
        class="rounded-xl bg-white ring-1 ring-inset ring-neutral-200 p-4 hover:bg-neutral-50 transition-colors responsive-card fade-in"
        [style.animation-delay]="rowIndex * 0.05 + 's'">
        <div class="flex items-center justify-between gap-3">
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
              data-lucide="file-text" class="lucide lucide-file-text w-4 h-4 text-neutral-500">
              <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
              <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
              <path d="M10 9H8"></path>
              <path d="M16 13H8"></path>
              <path d="M16 17H8"></path>
            </svg>
            <h3 class="text-base font-semibold tracking-tight text-neutral-900 responsive-card-title"
              style="font-family: 'Inter', ui-sans-serif, system-ui; letter-spacing: -0.02em;">
              {{invoice.invoiceNumber}}
            </h3>
          </div>
          <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs ring-1 ring-inset responsive-status-badge"
            [ngClass]="statusClasses[invoice.status!]">
            {{ invoice.status }}
          </span>
        </div>
        <div class="mt-2 text-sm text-neutral-700">{{ invoice.customer?.firstName }}</div>
        <div class="mt-1 text-xs text-gray-400">{{ invoice.customer?.email }}</div>
        <div class="mt-3 flex flex-col sm:flex-row sm:items-center justify-between text-sm gap-2">
          <div class="text-neutral-500">
            <span class="text-neutral-500">Issued:</span> {{ invoice.invoiceDate | date:'MMM d, y' }}
          </div>
          <div class="text-neutral-900 font-medium">{{invoice.grandTotal | currency:'INR':'symbol':'1.2-2'}}</div>
        </div>
        <div class="mt-3 flex items-center justify-between">
          <button (click)="openExisitingInvoice(invoice)"
            class="inline-flex items-center gap-1.5 text-sm text-neutral-700 hover:text-neutral-900 transition-colors responsive-view-button">
            View Details
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
              data-lucide="arrow-up-right" class="lucide lucide-arrow-up-right w-4 h-4">
              <path d="M7 7h10v10"></path>
              <path d="M7 17 17 7"></path>
            </svg>
          </button>
        </div>
      </article>
      }
    </section>

    <!-- Empty state -->
    <div id="empty" class="hidden mt-14 flex flex-col items-center justify-center text-center responsive-empty-state"
      *ngIf="invoiceList.length == 0">
      <div class="h-12 w-12 rounded-lg bg-neutral-50 ring-1 ring-inset ring-neutral-200 grid place-items-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="inbox"
          class="lucide lucide-inbox w-6 h-6 text-neutral-500">
          <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline>
          <path
            d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z">
          </path>
        </svg>
      </div>
      <h3 class="mt-4 text-lg font-semibold tracking-tight text-neutral-900 responsive-empty-title"
        style="font-family: 'Inter', ui-sans-serif, system-ui; letter-spacing: -0.02em;">
        No invoices match your filters
      </h3>
      <p class="mt-1 text-sm text-neutral-600 responsive-empty-description">
        Try a different status or clear your search.
      </p>
    </div>

    <!-- Bottom Pagination -->
    <mat-paginator [length]="totalElements" [pageSize]="pageSize" aria-label="Select page" class="mt-6 mb-6"
      (page)="onPageChange($event)">
    </mat-paginator>

  </div>
</div>