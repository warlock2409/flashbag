<div class="fixed inset-0 backdrop-blur-sm flex items-center justify-center p-0 z-50 pos">
    <div class="bg-white rounded-none shadow-2xl w-full h-full flex flex-col dialog-animate">
        <!-- Dialog Header -->
        <div class="flex justify-between items-center border-b border-gray-200 py-3 px-6">
            <h2 class="text-lg font-semibold text-gray-800 m-0">
                <i class="fa-regular fa-chess-queen text-violet-600 "></i>
                Ultimate Sales Machine
            </h2>
            <button (click)="closeDialog()" class="text-gray-400 hover:text-red-500 cursor-pointer">
                <mat-icon style="color: lightcoral;">cancel</mat-icon>
            </button>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-2 space-y-6">
            <!-- Your content goes here -->
            <div class="flex flex-col h-full">
                <div class="flex-1 flex">
                    <!-- Sidebar Navigation -->
                    <div class="w-26 p-2 overflow-hidden rounded-xl text-white flex-shrink-0 hidden md:block">
                        <nav class="flex flex-col items-center space-y-4 w-full">
                            <div *ngFor="let category of categories" (click)="onCategoryChange(category.id)" [ngClass]="{
                                'bg-violet-200 text-black': activeCategory === category.id,
                                'text-gray-600 hover:text-white hover:bg-violet-400': activeCategory !== category.id}"
                                class="flex flex-col items-center justify-center cursor-pointer px-2 py-3 rounded transition-colors w-full text-center">
                                <!-- Material icon -->
                                <mat-icon class="mb-1">{{ category.icon }}</mat-icon>

                                <span class="text-xs font-medium">{{ category.name }}</span>
                            </div>
                        </nav>
                    </div>

                    <!-- Main content -->
                    <div class="flex-1 flex flex-col overflow-hidden p-4">
                        <div class="flex justify-between items-center mb-4">
                            <div class="text-lg font-medium text-gray-500">{{ activeCategoryName }} Catalog</div>
                            <input type="text" [(ngModel)]="searchQuery" placeholder="Search items.."
                                class="pl-2 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-violet-400">
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div *ngFor="let item of filteredItems" class="border-gray-200 border p-3 rounded shadow">
                                <img [src]="item.image ? item.image:placeHolderImg" [alt]="item.name"
                                    class="h-32 w-full object-cover mb-2 rounded" />
                                <h3 class="font-semibold">{{ item.name }}</h3>
                                <p class="text-sm line-clamp-3">{{ item.description }}</p>
                                <div class="flex justify-between items-center mt-auto">
                                    <span class="font-medium text-green-600">{{ item.basePrice.toFixed(2) |
                                        currency:'INR':'symbol':'1.2-2' }}</span>
                                    <button (click)="addToCart(item)" mat-stroked-button>Add</button>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!--  -->
                    <!-- Right Sidebar -->
                    <div class="w-full md:w-120 bg-white border-l border-gray-200 flex flex-col h-full">
                        <!-- Customer Info -->
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="font-semibold text-lg mb-3">Customer</h3>
                            <div class="space-y-3">
                                <div (click)="openGodBoxCustomer()">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Search Customer</label>
                                    <div class="relative">
                                        <input type="text" [(ngModel)]="customerName" placeholder="Name or phone..."
                                            class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <i class="fa-solid fa-user absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                </div>
                                <button (click)="addCustomerMannually()" [disabled]="invoice.invoiceNumber"
                                    class="w-full py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-colors">
                                    {{invoice.invoiceNumber ? invoice.invoiceNumber : "+ New Customer"}}
                                </button>
                            </div>

                        </div>

                        <!-- Shopping Cart -->
                        <div class="overflow-y-auto p-4 flex flex-col"
                            [ngStyle]="{'height': showNewCustomerForm ? '24vh' : '52vh'}">
                            <h3 class="font-semibold text-lg mb-3">Shopping Cart</h3>

                            <div *ngIf="cart.length === 0" class="text-center py-8 text-gray-500">
                                <i class="fa-regular fa-hourglass"></i>
                                <p class="mt-2">Your cart is empty</p>
                            </div>

                            <div *ngFor="let item of cart; let i = index"
                                class="flex items-start border-b border-gray-100 pb-3 mb-2">

                                <!-- Product Image -->
                                <div class="w-16 h-16 bg-gray-100 rounded-md overflow-hidden flex-shrink-0">
                                    <img [src]="item.image ? item.image:placeHolderImg" [alt]="item.name"
                                        class="w-full h-full object-cover">
                                </div>

                                <!-- Name -->
                                <div class="ml-3 flex-1">
                                    <h4 class="font-medium" style="margin-bottom: 0;">
                                        {{ item.name }}
                                    </h4>
                                    <h4 *ngIf="item.startDate" style="margin-bottom: 0; color: gray;font-size: .9rem;">
                                        {{ item.startDate | date:'mediumDate' }}
                                    </h4>
                                </div>

                                <!-- Right Section: basePrice on top, Quantity adjustment below, Remove button -->
                                <div class="flex flex-col items-end space-y-2 ml-3">

                                    <span class="font-bold text-green-600">
                                        ({{ item.taxRate }}%) 
                                        {{ (item.basePrice * (item?.quantity ?? 1)) | currency:'INR':'symbol':'1.2-2' }}
                                    </span>

                                    <div class="flex gap-2 items-center">
                                        <i class="fa-solid fa-trash cursor-pointer text-red-400"
                                            (click)="removeFromCart(i)"></i>
                                        <!-- Quantity adjustment -->
                                        <div class="flex items-center border border-gray-300 rounded">
                                            <button (click)="updateQuantity(i, -1)"
                                                class="w-6 h-6 flex items-center justify-center hover:bg-gray-100 rounded-l">
                                                <i class="fa-solid fa-minus"></i>
                                            </button>
                                            <span
                                                class="w-8 h-6 flex items-center justify-center border-l border-r border-gray-300 text-sm">
                                                {{ item.quantity }}
                                            </span>
                                            <button (click)="updateQuantity(i, 1)"
                                                class="w-6 h-6 flex items-center justify-center hover:bg-gray-100 rounded-r">
                                                <i class="fa-solid fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <!-- Checkout Summary -->
                        <div class="p-4 border-t border-gray-200 flex-shrink-0">
                            <h3 class="font-semibold text-lg mb-3">Order Summary</h3>
                            <div class="space-y-2 mb-4">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Subtotal</span>
                                    <span>{{ subtotal.toFixed(2) | currency:'INR':'symbol':'1.2-2' }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Tax (8%)</span>
                                    <span>{{ tax.toFixed(2) | currency:'INR':'symbol':'1.2-2'}}</span>
                                </div>
                                <div class="flex justify-between font-bold text-lg mt-2">
                                    <span>Total</span>
                                    <span>{{ total.toFixed(2) | currency:'INR':'symbol':'1.2-2' }}</span>
                                </div>
                            </div>

                            <button (click)="createInvoice()" [disabled]="cart.length === 0" *ngIf="!invoice.status"
                                [ngClass]="{'bg-violet-100 cursor-not-allowed': cart.length === 0, 'cursor-pointer bg-violet-300 hover:bg-violet-400 font-medium': cart.length > 0}"
                                class="w-full py-3 rounded-lg transition-colors">
                                {{invoiceButtonText}}
                            </button>

                            <div class="flex gap-2 mt-4 justify-center" *ngIf="invoice.status">
                                <button *ngFor="let action of getAvailableActions(invoice.status!)"
                                    [disabled]="cart.length === 0" 
                                    [ngClass]="[cart.length === 0 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : actionButtonClasses[action]]" 
                                    (click)="handleAction(action, invoice)"
                                    class="px-3 py-1.5 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-400">
                                    {{ action }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>